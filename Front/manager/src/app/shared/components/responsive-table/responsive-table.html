<div class="responsive-table-container">
  <div class="top-table">
    <div class="top-search">
      <i class="fa-solid fa-magnifying-glass"></i>
      <input type="text" placeholder="Busca clientes, tickets o proyectos..." />
    </div>
    <div class="top-buttons">
        <button class="btn" title="Filtrar">
          <i class="fa-solid fa-filter"></i> Filtrar
        </button>
        <button class="btn" title="Exportar">
          <i class="fa-solid fa-file-download"></i> Exportar
        </button>
    </div>
  </div>
  @if (data!.length > 0) {
    <table>
      <thead>
        <tr>
          @for (col of columns; track col.key) {
            <th>{{ col.label }}</th>
          }
        </tr>
      </thead>
      <tbody>
        @for (row of data; track row) {
          <tr>
            @for (col of columns; track col.key) {
              <td>
                @if (col.type === 'avatar_text' && row[col.key]) {
                  <ng-container *ngIf="asAvatarText(row, col.key) as avatar">
                    <div style="display:flex;align-items:center;gap:8px;">
                      <img [src]="avatar.img" [alt]="avatar.name" style="width:32px;height:32px;border-radius:50%" />
                      <div>
                        <div>{{ avatar.name }}</div>
                        <small *ngIf="avatar.subtext">{{ avatar.subtext }}</small>
                      </div>
                    </div>
                  </ng-container>
                } @else if (col.type === 'badge' && row[col.key]) {
                  <ng-container *ngIf="asBadge(row, col.key) as badge">
                    <span class="badge" [ngClass]="'badge-' + (badge.type || 'default')">
                    â€¢ {{ badge.label }}
                    </span>
                  </ng-container>
                } @else if (col.type === 'currency' && row[col.key]) {
                  <ng-container *ngIf="asCurrency(row, col.key) as currency">
                    <span class="currency">{{ currency.amount | currency:currency.currencySymbol }}</span>
                  </ng-container>
                } @else if (col.type === 'avatars' && row[col.key]) {
                  <ng-container *ngIf="asAssignedUsers(row, col.key) as users">
                    <div style="display:flex;align-items:center;gap:4px;">
                      @for (user of users; track user.img) {
                        <img [src]="user.img" [alt]="user.name" style="width:24px;height:24px;border-radius:50%" />
                      }
                    </div>
                  </ng-container>
                } @else if (col.type === 'actions' && row[col.key]) {
                    <ng-container *ngIf="asActions(row, col.key) as actions">
                      <div class="actions-menu-wrapper" style="position:relative;display:inline-block;">
                        <button type="button" class="btn-action" [title]="'Acciones'" (click)="row._showMenu = !row._showMenu">
                          <i class="fa-solid fa-ellipsis-v"></i>
                        </button>
                        <ul *ngIf="row._showMenu" class="actions-menu" style="position:absolute;right:0;z-index:10;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.15);margin:0;padding:4px 0;list-style:none;min-width:140px;">
                          <li *ngFor="let action of actions" (click)="action.callback(); row._showMenu = false" style="padding:8px 16px;cursor:pointer;white-space:nowrap;">
                            <i *ngIf="action.icon" [class]="'fa-solid fa-' + action.icon" style="font-size:18px;vertical-align:middle;margin-right:8px;"></i>
                            {{ action.tooltip }}
                          </li>
                        </ul>
                      </div>
                    </ng-container>
                } @else if (col.type === 'date' && row[col.key]) {
                  <ng-container *ngIf="asDateInfo(row, col.key) as dateInfo">
                    <span>{{ dateInfo.date | date:dateInfo.format || 'shortDate' }}</span>
                  </ng-container>
                } @else if (col.type === 'boolean' && row[col.key]) {
                  <ng-container *ngIf="asBooleanInfo(row, col.key) as boolInfo">
                    <span>
                      @if (boolInfo.value) {
                        <i class="material-icons" style="color:green;">check_circle</i>
                        <span *ngIf="boolInfo.trueLabel">{{ boolInfo.trueLabel }}</span>
                      } @else {
                        <i class="material-icons" style="color:red;">cancel</i>
                        <span *ngIf="boolInfo.falseLabel">{{ boolInfo.falseLabel }}</span>
                      }
                    </span>
                  </ng-container>
                } @else if (col.type === 'number' && row[col.key]) {
                  <ng-container *ngIf="asNumberInfo(row, col.key) as numberInfo">
                    <span>{{ numberInfo.value }}</span>
                  </ng-container>
                } @else if (col.type === 'text' && row[col.key]) {
                  <ng-container *ngIf="asTextInfo(row, col.key) as textInfo">
                    <span>{{ textInfo.value }}</span>
                  </ng-container>
                } @else {
                  <span>{{ row[col.key] }}</span>
                }
              </td>
            }
          </tr>
        }
      </tbody>
    </table>
  } @else {
    <div class="empty-state">
      <img src="assets/images/empty-table.svg" alt="Sin datos" />
      <p class="empty-state-text">No se encontraron resultados</p>
    </div>
  }
</div>
